<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>My AR World - Jamaica</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar-nft.js"></script>
    <script src="https://unpkg.com/aframe-gps-entity-place/dist/aframe-gps-entity-place.min.js"></script>
  </head>
  <body style="margin:0; overflow:hidden;">
    <select id="parish-select" style="position: absolute; top: 10px; left: 10px; z-index: 2;">
      <option value="">Select Parish</option>
      <option value="kingston.json">Kingston</option>
      <option value="st_mary.json">St. Mary</option>
      <option value="st_catherine.json">St. Catherine (Spanish Town)</option>
    </select>

    <a-scene
      vr-mode-ui="enabled: false"
      embedded
      arjs="sourceType: webcam; videoTexture: true; debugUIEnabled: false;"
      renderer="antialias: true; alpha: true">
      
      <a-camera gps-camera rotation-reader></a-camera>
    </a-scene>

    <script>
      const select = document.getElementById("parish-select");
      select.addEventListener("change", async (e) => {
        const scene = document.querySelector("a-scene");
        // Remove old objects
        document.querySelectorAll("[gps-entity-place]").forEach(el => el.parentNode.removeChild(el));
        
        if (!e.target.value) return;

        const response = await fetch(e.target.value);
        const data = await response.json();

        data.drops.forEach(drop => {
          if (drop.type === "text") {
            const textEl = document.createElement("a-text");
            textEl.setAttribute("value", drop.content);
            textEl.setAttribute("look-at", "[gps-camera]");
            textEl.setAttribute("scale", "15 15 15");
            textEl.setAttribute("gps-entity-place", `latitude: ${drop.lat}; longitude: ${drop.lng};`);
            scene.appendChild(textEl);
          }
          if (drop.type === "3d_model") {
            const modelEl = document.createElement("a-entity");
            modelEl.setAttribute("gps-entity-place", `latitude: ${drop.lat}; longitude: ${drop.lng};`);
            modelEl.setAttribute("gltf-model", drop.asset);
            modelEl.setAttribute("scale", "5 5 5");
            modelEl.setAttribute("look-at", "[gps-camera]");
            scene.appendChild(modelEl);
          }
        });
      });
    </script>
  </body>
</html>
